<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>MAC Scanner Results</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
</head>
<body>
  <div class="container mt-5">
    <h2 class="mb-4">üìã MAC Scanner Results</h2>

    <table class="table table-bordered table-striped table-hover" id="macTable">
      <thead class="table-dark">
        <tr>
          <th>MAC Address</th>
          <th>Last Transmission</th>
          <th>Number of Measurements</th>
          <th>Device Type</th>
        </tr>
      </thead>
      <tbody>
        <!-- Filled dynamically via JS -->
      </tbody>
    </table>

    <a href="/" class="btn btn-secondary mt-4">‚Üê Back to Home</a>
  </div>

  <!-- JS Script block -->
  <script>
    fetch('/api/scan_macs/results')
      .then(response => response.json())
      .then(data => {
        const tableBody = document.querySelector('#macTable tbody');
        tableBody.innerHTML = '';

        data.forEach(device => {
          const row = document.createElement('tr');

          // MAC cell with optional inactive badge
          const macCell = document.createElement('td');
          macCell.innerHTML = device.mac + (device.is_inactive
            ? ' <span class="badge bg-danger ms-2">Inactive</span>'
            : '');
          row.appendChild(macCell);

          // Last transmission
          const lastUpdateCell = document.createElement('td');
          lastUpdateCell.textContent = device.last_update || 'N/A';
          row.appendChild(lastUpdateCell);

          // Number of measurements
          const sampleCountCell = document.createElement('td');
          const sampleData = device.sample_data || {};
          const numMeasurements = Object.keys(sampleData).length;
          sampleCountCell.textContent = numMeasurements;
          row.appendChild(sampleCountCell);

          // Device type
          const typeCell = document.createElement('td');
          typeCell.textContent = device.device_type || 'Unknown';
          row.appendChild(typeCell);

          tableBody.appendChild(row);
        });
      })
      .catch(error => {
        console.error("Error fetching MAC data:", error);
        const tableBody = document.querySelector('#macTable tbody');
        tableBody.innerHTML = '<tr><td colspan="4">Failed to load data</td></tr>';
      });
  </script>
</body>
</html>
